<ul>
<% for group in  @auto_groups %>
  <li>
    <span class="groupname"><%= highlight_match(h(group.name), @infix) %></span>
    <p style="font-size: small">
    <% infix_users =  group.users.all(:conditions => ["name LIKE :infix OR username LIKE :infix", {:infix => "%#{@infix}%"}]) %>
    <% users = group.users.all(:conditions => ["name NOT LIKE :infix AND username NOT LIKE :infix", {:infix => "%#{@infix}%"}]) %>
    <% for user in infix_users %>
        <%= highlight_match(h(user.username), @infix)%>  
        <% if !user.username.downcase.include?(@infix.downcase) && user.name.downcase.include?(@infix.downcase)%>
          (<%= highlight_match(h(user.name), @infix)%>)
        <% end%><% if infix_users.length < 3 && users.length > 0 %>,<% end %>
    <% end %>
    <%= highlight_match(h(users.first(3 - infix_users.length).collect(&:username).join(', ')), @infix) %>
    <% if (group.users.length > 3) %>&hellip;<% end %>
    </p>
  </li>
<% end %>
</ul>